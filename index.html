<!doctype html>
<html>

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

	<title>Searching Limits</title>

	<link rel="shortcut icon" type="image/x-icon" href="favicon/favicon.ico" />
	<link rel="stylesheet" href="css/reset.css">
	<link rel="stylesheet" href="css/reveal.css">
	<link rel="stylesheet" href="css/theme/black.css">

	<!-- Theme used for syntax highlighting of code -->
	<link rel="stylesheet" href="lib/css/monokai.css">

	<!-- Printing and PDF exports -->
	<script>
		var link = document.createElement('link');
		link.rel = 'stylesheet';
		link.type = 'text/css';
		link.href = window.location.search.match(/print-pdf/gi) ? 'css/print/pdf.css' : 'css/print/paper.css';
		document.getElementsByTagName('head')[0].appendChild(link);
	</script>

</head>

<body>
	<div class="reveal">
		<div class="slides">


<!-- This is the front page -->
			<section data-background-image="./../../img/af-title-2019.png">
			</section>


<!-- Introduction of myself -->
			<section data-background-image="./../../img/af-2019-background.png">
				<style>
					.container {
						display: flex;
					}

					.col {
						flex: 1;
					}
				</style>
				<div class="container">

					<div class="col" class="bgimg">
						<img src="img/marco.jpg" alt="Avatar" class="">

					</div>

					<div class="col">
						<table style="border-collapse: collapse; width: 100%; height: 90px;" border="0">
							<tbody>
								<tr style="height: 18px;">
									<td style="width: 24%; height: 18px;"><strong>Name:</strong></td>
									<td style="width: 76.6579%; height: 18px;">Marco van Dam</td>
								</tr>
								<tr style="height: 18px;">
									<td style="width: 24%; height: 18px;"><strong>Age:</strong></td>
									<td style="width: 76%; height: 18px;">38</td>
								</tr>
								<tr style="height: 18px;">
									<td style="width: 24%; height: 18px;"> <strong>Status:</strong></td>
									<td style="width: 76%; height: 18px;">Married</td>
								</tr>
								<tr style="height: 18px;">
									<td style="width: 24%; height: 18px;"><strong>Kids:</strong></td>
									<td style="width: 76%; height: 18px;">1 daughter</td>
								</tr>
								<tr>
									<td style="width: 24%;"><strong>Occupation:</strong></td>
									<td style="width: 76%;">Chapterlead</td>
								</tr>
								<tr>
									<td style="width: 24%;"><strong>Company:</strong></td>
									<td style="width: 76%;">ING Bank</td>
								</tr>
							</tbody>
						</table>
					</div>

				</div>
			</section>

<!-- Introduction of ING -->
<section>
			<section data-background-color="#fff">
				<style>
					.reveal section img {
						background: none;
						border: none;
						box-shadow: none;
					}
				</style>
				<img src="img/ing_logo.jpg" alt="ING_logo">
			</section>

			<section data-background-color="#fff">
				</style>
				<span style="color: #ff6600;"><strong>Lets talk numbers:</strong></span>

				<table style="border-collapse: collapse; width: 100%; height: 108px;">
					<tbody>
						<tr style="height: 18px;">
							<td style="width: 28.0235%; height: 18px;">Employees:</td>
							<td style="width: 71.9765%; height: 18px;">54.000 +</td>
						</tr>
						<tr style="height: 18px;">
							<td style="width: 28.0235%; height: 18px;"><span style="color: #ff6600;"><strong>IT
										Engineers</strong></span></td>
							<td style="width: 71.9765%; height: 18px;"><span style="color: #ff6600;"><strong>10.000
										+</strong></span></td>
						</tr>
						<tr style="height: 18px;">
							<td style="width: 28.0235%; height: 18px;">Customers:</td>
							<td style="width: 71.9765%; height: 18px;">38.3 million across the world</td>
						</tr>
						<tr style="height: 18px;">
							<td style="width: 28.0235%; height: 18px;">Countries</td>
							<td style="width: 71.9765%; height: 18px;">Over 40 countries</td>
						</tr>
					</tbody>
				</table>

				<aside class="notes">
					ING is a global bank with a strong European base. Our 54,000 employees serve around 38.4 million
					customers,
					corporate clients and financial institutions in over 40 countries. Our purpose is to empower people
					to stay
					a step ahead in life and in business.Our products include savings, payments, investments, loans and
					mortgages
					in most of our retail markets. For our Wholesale Banking clients we provide specialised lending,
					tailored corporate finance,
					debt and equity market solutions, payments & cash management and trade and treasury services.
				</aside>
			</section>

			<!-- <section data-background-image="./../../img/af-2019-background.png"> -->
			<section data-background-color="#fff">
				<span style="color: #ff6600;"><strong>ING locations</strong></span>

				<img src="img/ing-world.png" alt="Organizations">


				<aside class="notes">
					These are countries where we are in. As a Global company ING thrives to have local teams take
					ownership of their applications
					The DevOps mindset and Agile workenvironment enhances the segregated setup. Therefor Teams are the
					owners of their environements
					All teams (of 8 to 10 DevOps engineers) can execute their own written playbooks.
				</aside>
			</section>


			<section data-background-color="#fff">
					<h2><span style="color: #ff6600;"><strong>The Use Case</strong></span></h2>
				 	<strong>Assignment:</strong>	
					<br />
					Migrate all teams away from old vendor to <strong>Ansible</strong>
				</section>

				<section data-background-color="#fff">
						<h2><span style="color: #ff6600;"><strong>Environmental Challenges</strong></span></h2>

						<p> Compliance Rules per country</p>
						<p> DevOps teams responsible for their own setup</P>
						<p> Distributed setup --> One Pipeline</p>
						<p>  Many different datacenters cross globe</p>
						<p>  Segregated network topology</p>
						<p>  Segregated UAM per country</p>
						<p> Timeline constraints (4 months)</p>
					<aside class="notes">
						ING had a setup with a vendor application which we needed to decommision. This application was running 
						in multiple countries in multiple datacenters (using agents and masters). Since ING has a segregated network 
						topology with different kind of configurations per country and the user access model is also segregated per 
						country (minor difference, but the devil is in the details.) The challenge to get from a distributed Setup
						to a generic One Pipeline setup is huge. 
						O and by the the deadline is in 4 months .... good luck! And ofcourse we did not make the deadline! 
					</aside>
				</section>

</section>


			<!-- The Setup -->
<section>
			<section data-background-image="./../../img/af-2019-background.png">
				<img src="img/CDaaS_onboarding.png" alt="CDaaS_onboarding">

				<aside class="notes">
					Ansible Tower is setup using 2 clusters. See reference: Ansible The Two Towers by Robert de Bock and
					Dennis van Velzen
					given at Ansiblefest 2018 Austin. The onboarding of new organisation is self service.
					There is one tower organisation that has the admin credentials needed to create organisations.
					Also there is a job template with a playbook (managed by the admins) that can create/delete
					a new organisation and create an LDAP ou and an NPA to get access to only that organisation.
				</aside>
			</section>
</section>

<!-- Organizations = Team -->
			<section data-background-image="./../../img/af-2019-background.png">
				1 organization = 1 team
				<aside>

				</aside>
			</section>


<!-- Tower numbers -->
<section>
			<section data-background-image="./../../img/af-2019-background.png">
				<span style="color: #ff6600;"><strong>Current situation today</strong></span>

				<table style="width: 100%;">
					<table style="width: 100%;">
						<tbody>
							<tr>
								<td style="width: 41.8087%;"><strong>Organizations:</strong></td>
								<td style="width: 58.0602%;">987 increasing daily</td>
							</tr>
							<tr>
								<td style="width: 41.8087%;"><strong>Inventories:</strong></td>
								<td style="width: 58.0602%;">6083</td>
							</tr>
							<tr>
								<td style="width: 41.8087%;"><strong>Projects:</strong></td>
								<td style="width: 58.0602%;">1830</td>
							</tr>
							<tr>
								<td style="width: 41.8087%;"><strong>Credentials:</strong></td>
								<td style="width: 58.0602%;">7639</td>
							</tr>
							<tr>
								<td style="width: 41.8087%;"><strong>Templates:</strong> </td>
								<td style="width: 58.0602%;">7501</td>
							</tr>
							<tr>
								<td style="width: 41.8087%;"><strong>Schedules</strong></td>
								<td style="width: 58.0602%;">113</td>
							</tr>
							<tr style="height: 18px;">
								<td style="width: 28.0235%; height: 18px;"><strong>Executions:</strong></td>
								<td style="width: 71.9765%; height: 18px;">97.035</td>
							</tr>
						</tbody>
					</table>
			</section>

			<section data-background-image="./../../img/af-2019-background.png">
				<span style="color: #ff6600;"><strong>Number of Organizations over time</strong></span>
				<img src="img/GrowthOrgs.png" alt="Organizations" class="graphs">

				<aside class="notes">
					As per today (September 2019) we have approximately 1000 organizations in our production environment
					in november 2018 we started a mass onboarding in a fully automated way using a playbook.
					Current number of organizations 987
					We are still onboarding and we expect over 1200 organizations in 2 tower clusters.
				</aside>

			</section>

			<section data-background-image="./../../img/af-2019-background.png">

				<span style="color: #ff6600;"><strong>Number of Playbooks executed per month</strong></span>
				<img src="img/GrowthExecutionPlaybook.png" alt="Organizations" class="graphs">


				<aside class="notes">
					the approximately 1000 organizations combined together produce 97000 + playbook runs per month
					which is:
					~ 3100 deployments per day
					~ 130 per hour
					~ 2 per minute
					24/7
				</aside>
			</section>
</section>

<!-- This is the configuration page -->
<section>
			<section data-background-image="./../../img/af-2019-background.png">
				<span style="color: #ff6600;"><strong>LETS TALK CODE</strong></span>
				<pre><code data-trim data-noescape>
							- name: "Lets talk Code"
								debug:
							  var: Onboarding_organization
					</code>
				</pre>
			</section>

			<section data-background-image="./../../img/af-2019-background.png">
				My favorite motto: <h2>RTFM</h2>
				<a
					href="https://docs.ansible.com/ansible-tower/latest/html/administration/ldap_auth.html">https://docs.ansible.com/ansible-tower/latest/html/administration/ldap_auth.html</a>
			</section>


			<section data-background-image="./../../img/af-2019-background.png">
				<span style="color: #ff6600;"><strong>Get current config from API</strong></span>
				<pre>
					<code>
		# We use the URI module to get the the current config from Tower
		- 	name: get current AUTH_LDAP_ORGANIZATION_MAP and AUTH_LDAP_TEAM_MAP from Ansible Tower API
			uri:
				url: "{{ tower_server_api_uri }}/settings/ldap/"
				method: GET
				user: "{{ ansible_tower_admin_user }}"
				password: "{{ ansible_tower_admin_pw }}"
				force_basic_auth: yes
				return_content: yes
				validate_certs: yes
			register: ansible_tower_ldap_json
			check_mode: no
					</code>


				</pre>
			</section>



			<section data-background-image="./../../img/af-2019-background.png">
				<span style="color: #ff6600;"><strong>Jinja2 template for mapping Organization to LDAP</strong></span>
				<pre>
		<code>
# We use a Jinja2 template to generate the configuration according to the given parameters
{
 "AUTH_LDAP_ORGANIZATION_MAP": {
	{% for  organisational_unit  in  organisational_units %}
	"{{ organisational_unit }}": {
	"admins": [
	  "cn=Administrators,ou=Non-Personal Accounts,ou={{ organisational_unit }},{{ organisation_groups_base_dn }}",
	  "cn=Administrators,ou=Personal Accounts,ou={{ organisational_unit }},{{ organisation_groups_base_dn }}"
	],
	"remove_admins": true,
	"users": [
	  "cn=Users,ou=Non-Personal Accounts,ou={{ organisational_unit }},{{ organisation_groups_base_dn }}",
	  "cn=Users,ou=Personal Accounts,ou={{ organisational_unit }},{{ organisation_groups_base_dn }}"
	],
	"remove_users": true
	}{{ "," if not loop.last else ''}}
	{% endfor %}
},
		</code>
	</pre>
			</section>

			<section data-background-image="./../../img/af-2019-background.png">
				<span style="color: #ff6600;"><strong>Jinja2 template for mapping LDAP to team </strong></span>
				<pre>
		<code >
"AUTH_LDAP_TEAM_MAP": {
   {% for  organisational_unit  in  organisational_units %}
   "{{ organisational_unit }}": {
	  "organization": "{{ organisational_unit }}",
	  "users": [
	  "cn=Administrators,ou=Non-Personal Accounts,ou={{ organisational_unit }},{{ organisation_groups_base_dn }}",
	  "cn=Users,ou=Non-Personal Accounts,ou={{ organisational_unit }},{{ organisation_groups_base_dn }}",
	  "cn=Administrators,ou=Personal Accounts,ou={{ organisational_unit }},{{ organisation_groups_base_dn }}",
	  "cn=Users,ou=Personal Accounts,ou={{ organisational_unit }},{{ organisation_groups_base_dn }}"
	  ],
	  "remove": true
	  }{{ "," if not loop.last else ''}}
   {% endfor %}
 }
}
			</code>
		</pre>
			</section>

			<section data-background-image="./../../img/af-2019-background.png">
				<span style="color: #ff6600;"><strong>PATCH current config from API</strong></span>
				<pre>
					<code>
# we register the output and push it through the URI module using a patch method
	- 	name: PATCH the AUTH_LDAP_ORGANIZATION_MAP and AUTH_LDAP_TEAM_MAP using the Ansible Tower API
		uri:
			url: "{{ tower_server_api_uri }}/settings/ldap/"
			method: PATCH
			user: "{{ ansible_tower_admin_user }}"
			password: "{{ ansible_tower_admin_pw }}"
			force_basic_auth: yes
			validate_certs: yes
			return_content: yes
			body: "{{ item }}"
			body_format: json
		with_template: auth_ldap_organisation.json.j2
		register: ansible_tower_ldap_patch
		changed_when: no
					</code>


				</pre>
			</section>



			<section data-background-image="./../../img/af-2019-background.png">
				<span style="color: #ff6600;"><strong>Jinja2 Result for Settings</strong></span>

				<pre>
			<code>
	"LIONS": {
		"organization": "LIONS",
		"users": [
			"cn=Administrators,ou=Non-Personal Accounts,ou=LIONS,ou=organisations,ou=FOO,o=Ansible Tower,
			"cn=Users,ou=Non-Personal Accounts,ou=LIONS,ou=organisations,ou=FOO,o=Ansible Tower,
			"cn=Administrators,ou=Personal Accounts,ou=LIONS,ou=organisations,o=FOO,ou=Ansible Tower,
			"cn=Users,ou=Personal Accounts,ou=LIONS,ou=organisations,ou=FOO,o=Ansible Tower
		],
		"remove": true
	}

				</code>
			</pre>
			</section>
</section>
<!-- This is the Challenges section -->

			<section data-background-image="./../../img/af-2019-background.png">
				<span style="color: #ff6600;"><strong>LDAP connectivity setup should be improved</strong></span>
				<img src="img/33.8.jpg" width="80%" height="80%  alt=" Organizations">
			</section>

			<section data-background-image="./../../img/af-2019-background.png">
				<span style="color: #ff6600;"><strong>Other Challenges</strong></span>

				<p>Logstash integration</p>
				<p> CyberArk integration</p>
				<p>First page query</p>
				<p> known bugs/issues like requirement.yml</p>

			
			</section>


			<!-- <section data-background-image="./../../img/af-2019-background.png">
				<p>Code can be found here:</p>
				<table style="height: 38px; width: 591px;">
					<tbody>
						<tr>
							<td style="width: 250px;"><img src="img/Octocat.png" alt="Octocat" width="250" /></td>
							<td style="width: 468px;">&nbsp;https://github.com/ing-bank</td>
						</tr>
					</tbody>
				</table>
			</section> -->


<!-- This is the Thanks page -->
<section> 
			<section data-background-image="./../../img/af-2019-thanks.png">
			</section>

			<section data-background-image="./../../img/af-2019-background.png">
				<h2><span style="color: #ff6600;"><strong>Special thank you to:</strong></span></h2>

				<ul>
						<li>Dennis van Velzen</li>
						<li>Robert de Bock</li>
						<li>Jelle van de Haterd</li>
						<li>Rob de Boer</li>
						<li>Alfons van Hallem</li>
						<li>Olaf Griffioen</li>
						<li>Francesco Cosentino</li>
						<li>Rob Onderwijzer</li>
					</ul>
			</section>
</section>

		</div>
	</div>

	<script src="js/reveal.js"></script>

	<script>
		Reveal.initialize({
			dependencies: [
				{ src: 'plugin/markdown/marked.js' },
				{ src: 'plugin/markdown/markdown.js' },
				{ src: 'plugin/notes/notes.js', async: true },
				{ src: 'plugin/highlight/highlight.js', async: true }
			]
		});
	</script>
</body>

</html>